var blurbGallery={init:function(a,b){var c=this;c.config=$.extend({},c.defaults,a);c.elem=b;c.$elem=$(b);$.when(c.load()).then(function(){c.render.call(c);c.events();c.format()},function(){alert("Error: Gallery load failed!")});return c},defaults:{ajaxCache:!1,ajaxDataType:"json",ajaxDataUrl:"json/jquery.single.json",callback:function(){},classActivePage:"bg-active-page",classActiveThumb:"bg-active-thumb",classCategory:"bg-category",classDescription:"bg-description",classEnlarge:"bg-enlarge",classGallery:"bg-gallery",
classImg:"bg-img",classImgCtn:"bg-img-ctn",classInfo:"bg-info",classLoading:"bg-loading",classLoadingImg:"bg-loading-img",classMoreLink:"bg-more-link",classNextLink:"bg-next-link",classPageLink:"bg-page-link",classPages:"bg-page-navigation",classPreviousLink:"bg-previous-link",classSelectMenu:"bg-select-menu",classSelectNav:"bg-select-nav",classThumbs:"bg-thumbs",classTitle:"bg-title",classWrapper:"bg-wrapper",html5:!0,loading:"img/bg-loading.gif",multiJSON:!1,pageMax:3,pagePer:3,pageShow:!0,pathFull:!1,
pathRoot:"img/",pathThumbs:"img/thumbs/",selectedCat:!1,selectedImg:!1,speed:300},load:function(){var a=this,b=$.Deferred();$.ajax({cache:a.config.ajaxCache,dataType:a.config.ajaxDataType,url:a.config.ajaxDataUrl}).then(function(c){a.data=c;$.when(a.findSelected()).then(function(){a.selected={cat:a.selectedCat,item:a.selectedItem};b.resolve()})},function(){b.reject()});return b.promise()},events:function(){var a=this;a.$elem.on("click","."+a.config.classThumbs+" a",function(b){a.changeItem.call(a,
$(this));b.preventDefault()});a.$elem.on("click","."+a.config.classPreviousLink,function(b){a.changePage.call(a,$(this),"previous");b.preventDefault()});a.$elem.on("click","."+a.config.classPageLink,function(b){a.changePage.call(a,$(this));b.preventDefault()});a.$elem.on("click","."+a.config.classNextLink,function(b){a.changePage.call(a,$(this),"next");b.preventDefault()});$(window).on("resize",function(){a.format()})},changeCategory:function(a){var b=this;a=b.utils.formatText(a);$("."+b.config.classImgCtn).hide();
$("."+b.config.classInfo).hide();b.config.loading&&$("."+b.config.classLoading).show();b.config.selectedCat=a;b.selected=b.findSelected();b.renderTitle($("."+b.config.classTitle));b.renderCategory($("."+b.config.classCategory));b.renderDescription($("."+b.config.classDescription));a=b.renderImage($("."+b.config.classImg));b.renderThumbs($("."+b.config.classThumbs));$.when(b.utils.preload(a),b.utils.preload(a)).then(function(){b.config.loading&&$("."+b.config.classLoading).hide();$("."+b.config.classImgCtn).fadeIn(b.config.speed);
$("."+b.config.classInfo).fadeIn(b.config.speed);b.config.callback()});b.pages={ctn:$("."+b.config.classPages),current:0,items:0,total:0,per:b.config.pagePer};b.renderPages($("."+b.config.classPages))},changeItem:function(a){var b=this,c=$("."+b.config.classLoadingImg);$("."+b.config.classImg).css("opacity",0);$("."+b.config.classEnlarge).css("opacity",0);$("."+b.config.classThumbs).find("a").removeClass(b.config.classActiveThumb);a.addClass(b.config.classActiveThumb);a=a.attr("href");b.findItem(a);
b.renderTitle($("."+b.config.classTitle));b.renderDescription($("."+b.config.classDescription));a=b.renderImage($("."+b.config.classImg));b.config.loading&&c.show();$.when(b.utils.preload(a)).then(function(){b.config.loading&&c.hide();$("."+b.config.classImg).animate({opacity:1},b.config.speed);$("."+b.config.classEnlarge).animate({opacity:1},b.config.speed);b.config.callback()})},changePage:function(a,b){var c,d;"previous"===b?0<this.pages.current&&(c=(this.pages.current-1)*this.pages.per,d=c+this.pages.per,
this.pages.current=parseInt(this.pages.current-1),this.renderPages($("."+this.config.classPages))):"next"===b?this.pages.current+1<this.pages.total&&(c=(this.pages.current+1)*this.pages.per,d=c+this.pages.per,this.pages.current=parseInt(this.pages.current+1),this.renderPages($("."+this.config.classPages))):(c=a.attr("id"),this.pages.current=parseInt(c),c=this.pages.current*this.pages.per,d=c+this.pages.per,this.renderPages($("."+this.config.classPages)));this.sortThumbs(c,d)},render:function(){var a=
this,b;b=a.config.html5?$("<section/>"):$("<div/>");b.attr({"class":a.config.classWrapper});a.$elem.append(b);$.when(function(){var c,d,e=a.categories,f,g,j;a.config.html5?(c=$("<section/>"),d=$("<nav/>")):(c=$("<div/>"),d=$("<div/>"));c.attr({"class":a.config.classSelectMenu});d.attr({"class":a.config.classSelectNav});g=0;for(j=e.length;g<j;++g)f=$("<a/>",{alt:e[g],href:"?cat="+a.utils.formatText(e[g]),html:e[g],title:e[g]}),d.append(f);c.append(d);b.append(c)}(),function(){var c,d,e=$.Deferred();
c=a.config.html5?$("<section/>"):$("<div/>");c.attr({"class":a.config.classGallery});b.append(c);a.config.loading&&(d=a.config.html5?$("<section/>"):$("<div/>"),d.attr({alt:"Loading...","class":a.config.classLoading,title:"Loading..."}).html('<img src="'+a.config.loading+'" />'),c.append(d));$.when(function(){var b,d,e,h,k=$.Deferred();a.config.html5?(b=$("<article/>"),d=$("<section/>"),e=$("<section/>")):(b=$("<div/>"),d=$("<div/>"),e=$("<div/>"));a.config.loading&&(h=a.config.html5?$("<section/>"):
$("<div/>"),h.attr({alt:"Loading...","class":a.config.classLoadingImg,title:"Loading..."}).html('<img src="'+a.config.loading+'" />'),d.append(h));b.attr({"class":a.config.classImg});d.attr({"class":a.config.classImgCtn});e.attr({"class":a.config.classEnlarge}).html("Click image to enlarge");h=a.renderImage(b);$.when(a.utils.preload(h)).done(function(){k.resolve()});d.append(b,e);c.append(d);return k.promise()}(),function(){var b,d,e,h,k=$.Deferred();a.config.html5?(b=$("<section/>"),d=$("<section/>"),
e=$("<section/>"),h=$("<section/>")):(b=$("<div/>"),d=$("<div/>"),e=$("<div/>"),h=$("<div/>"));b.attr({"class":a.config.classInfo});a.renderTitle(d);a.renderCategory(e);a.renderDescription(h);c.append(b);b.append(d);b.append(e);b.append(h);d=a.config.html5?$("<article/>"):$("<div/>");d.attr({"class":a.config.classThumbs});e=a.renderThumbs(d);$.when(a.utils.preload(e)).done(function(){k.resolve()});b.append(d);a.config.pageShow&&(d=a.config.html5?$("<section/>"):$("<div/>"),d.attr({"class":a.config.classPages}),
a.pages={ctn:d,current:0,items:0,pages:0,per:a.config.pagePer},a.renderPages(d),b.append(d));return k.promise()}()).then(function(){e.resolve()},function(){alert("Error: Gallery load failed!")});return e.promise()}()).then(function(){b.fadeIn(a.config.speed);a.config.callback()},function(){alert("Error: Failed to load gallery!")})},renderTitle:function(a){a.attr({alt:this.selected.item.title,"class":this.config.classTitle,title:this.selected.item.title}).html(this.selected.item.title)},renderCategory:function(a){a.attr({alt:this.selected.cat.id,
"class":this.config.classCategory,title:this.selected.cat.id}).html(this.selected.cat.id)},renderDescription:function(a){a.attr({alt:this.selected.item.info,"class":this.config.classDescription,title:this.selected.item.info}).html(this.selected.item.info)},renderImage:function(a){var b;a.empty();a=$("<a/>",{href:this.config.pathFull?this.config.pathFull+this.selected.item.img:this.config.pathRoot+this.selected.item.img}).appendTo(a);b=this.config.pathRoot+this.selected.item.img;$("<img/>",{src:b}).appendTo(a);
return b},renderThumbs:function(a){var b=[],c,d,e,f;a.empty();for(f in this.selected.cat.item)d=$("<a/>").attr({href:this.selected.cat.item[f].img}),this.selected.item.img===this.selected.cat.item[f].img&&d.addClass(this.config.classActiveThumb),c=this.config.pathThumbs?this.config.pathThumbs+this.selected.cat.item[f].img:this.config.pathRoot+this.selected.cat.item[f].img,e=$("<img/>").attr({src:c}),d.append(e).appendTo(a),b.push(c);return b},renderPages:function(a){a.empty();this.pages.items=this.selected.cat.item.length;
this.pages.total=Math.ceil(this.pages.items/this.pages.per);if(this.pages.items>this.pages.per){var b,c,d;this.config.html5?(a=$("<section/>"),b=$("<section/>")):(a=$("<div/>"),b=$("<div/>"));a.attr({alt:"Previous","class":this.config.classPreviousLink,title:"Previous"}).html("<< Previous");b.attr({alt:"next","class":this.config.classNextLink,title:"next"}).html("Next >>");this.pages.ctn.append(a);for(d=this.pages.total>this.config.pageMax?this.pages.current:0;this.pages.total>d;++d)if(c=this.config.html5?
$("<section/>",{alt:"Page "+(d+1),"class":this.config.classPageLink,html:d+1,id:d,title:"Page "+(d+1)}):$("<div/>",{alt:"Page "+(d+1),"class":this.config.classPageLink,html:d+1,id:d,title:"Page "+(d+1)}),d===this.pages.current&&c.addClass(this.config.classActivePage),this.pages.ctn.append(c),d+1===this.config.pageMax+this.pages.current){d+1<this.pages.total&&(c=this.config.html5?$("<section/>",{html:"...","class":this.config.classMoreLink}):$("<div/>",{html:"...","class":this.config.classMoreLink}),
this.pages.ctn.append(c));break}this.pages.ctn.append(b);0===this.pages.current?a.hide():a.show();this.pages.current===this.pages.total-1?b.hide():b.css("display","inline-block");this.sortThumbs()}},findSelected:function(){var a=this,b=$.Deferred(),c=$("#bg-selected-cat").attr("value"),d=$("#bg-selected-img").attr("value"),e;a.categories=[];if(a.config.multiJSON){e=a.data.categories;if(c){var f,g;f=0;for(g=e.length;f<g;++f)c===a.utils.formatText(e[f].id)&&(a.selectedCat=e[f].id),a.categories.push(e[f].id)}else{i=
0;for(l=e.length;i<l;++i)a.categories.push(e[i].id);a.selectedCat=e[0].id}$.ajax({cache:a.config.ajaxCache,dataType:a.config.ajaxDataType,url:"json/"+a.utils.formatText(a.selectedCat)+".json"}).then(function(c){var e=c.items.item,f;a.selectedCat=c.items;if(d){c=0;for(f=e.length;c<f;++c)d===a.utils.formatText(e[c].title)&&(a.selectedItem=e[c])}else a.selectedItem=e[0];b.resolve()})}else{e=a.data.items;if(c){f=0;for(g=e.length;f<g;++f){a.categories.push(e[f].id);var j=e[f];c===a.utils.formatText(e[f].id)&&
(a.selectedCat=j)}}else{a.selectedCat=e[0];f=0;for(g=e.length;f<g;++f)a.categories.push(e[f].id)}if(d){f=0;for(g=e.length;f<g;++f)for(var j=e[f],h=c=void 0,k=void 0,c=0,h=j.item.length;c<h;++c)k=a.utils.formatText(j.item[c].title),d===k&&(a.selectedItem=j.item[c])}else a.selectedItem=e[0].item[0];b.resolve()}return b.promise()},findItem:function(a){var b=this.selected.cat,c;for(c in b.item)b.item[c].img===a&&(this.selected.item=b.item[c])},sortThumbs:function(a,b){var c;a||(a=this.pages.current*this.pages.per);
b||(b=a+this.pages.per);c=$(".bg-thumbs a");c.hide();c.slice(a,b).show()},format:function(){var a;a=$(window).width();780>=a?$("."+this.config.classInfo).prepend($("."+this.config.classThumbs),$("."+this.config.classPages)):780<a&&$("."+this.config.classInfo).append($("."+this.config.classThumbs),$("."+this.config.classPages))},utils:{formatText:function(a){a=a.toLowerCase();a=a.replace(/ /g,"_");a=a.replace(/&/g,"and");return a=a.replace(/[^a-z0-9_]/g,"")},preload:function(a){var b=$.Deferred(),
c=[],d,e,f;$.isArray(a)||(a=[a]);e=a.length;for(var g=0;g<e;g++)f=$.Deferred(),d=$("<img />"),d.load(f.resolve),d.error(f.resolve),c.push(f),d.get(0).src=a[g];$.when.apply(this,c).done(b.resolve);return b.promise()}}};"function"!==typeof Object.create&&(Object.create=function(a){function b(){}b.prototype=a;return new b});$.plugin=function(a,b){$.fn[a]=function(c){return this.each(function(){$.data(this,a)||$.data(this,a,Object.create(b).init(c,this))})}};$.plugin("blurbGallery",blurbGallery);