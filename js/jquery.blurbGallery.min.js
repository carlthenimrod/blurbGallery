var blurbGallery={init:function(a,b){var d=this;d.config=$.extend({},d.defaults,a);d.elem=b;d.$elem=$(b);$.when(d.load()).then(function(){d.render.call(d);d.events()},function(){alert("Error: Gallery load failed!")});return d},defaults:{ajaxCache:!1,ajaxDataType:"json",ajaxDataUrl:"json/jquery.items.json",callback:function(){},classActivePage:"bg-active-page",classActiveThumb:"bg-active-thumb",classCategory:"bg-category",classDescription:"bg-description",classEnlarge:"bg-enlarge",classGallery:"bg-gallery",
classImg:"bg-img",classImgCtn:"bg-img-ctn",classInfo:"bg-info",classLoading:"bg-loading",classLoadingImg:"bg-loading-img",classMoreLink:"bg-more-link",classNextLink:"bg-next-link",classPageLink:"bg-page-link",classPages:"bg-page-navigation",classPreviousLink:"bg-previous-link",classSelectMenu:"bg-select-menu",classSelectNav:"bg-select-nav",classThumbs:"bg-thumbs",classTitle:"bg-title",classWrapper:"bg-wrapper",html5:!0,loading:"img/bg-loading.gif",pageMax:3,pagePer:3,pageShow:!0,pathFull:!1,pathRoot:"img/",
pathThumbs:"img/thumbs/",selectedCat:!1,selectedImg:!1,speed:300},load:function(){var a=this,b=$.Deferred();$.ajax({cache:a.config.ajaxCache,dataType:a.config.ajaxDataType,url:a.config.ajaxDataUrl}).then(function(d){a.data=d;a.selected=a.findSelected(!0);b.resolve()},function(){b.reject()});return b.promise()},events:function(){var a=this;a.$elem.on("click","."+a.config.classSelectNav+" a",function(b){a.changeCategory.call(a,$(this).html());b.preventDefault()});a.$elem.on("click","."+a.config.classThumbs+
" a",function(b){a.changeItem.call(a,$(this));b.preventDefault()});a.$elem.on("click","."+a.config.classPreviousLink,function(b){a.changePage.call(a,$(this),"previous");b.preventDefault()});a.$elem.on("click","."+a.config.classPageLink,function(b){a.changePage.call(a,$(this));b.preventDefault()});a.$elem.on("click","."+a.config.classNextLink,function(b){a.changePage.call(a,$(this),"next");b.preventDefault()})},changeCategory:function(a){var b=this;a=b.utils.formatText(a);$("."+b.config.classImgCtn).hide();
$("."+b.config.classInfo).hide();b.config.loading&&$("."+b.config.classLoading).show();b.config.selectedCat=a;b.selected=b.findSelected();b.renderTitle($("."+b.config.classTitle));b.renderCategory($("."+b.config.classCategory));b.renderDescription($("."+b.config.classDescription));a=b.renderImage($("."+b.config.classImg));b.renderThumbs($("."+b.config.classThumbs));$.when(b.utils.preload(a),b.utils.preload(a)).then(function(){b.config.loading&&$("."+b.config.classLoading).hide();$("."+b.config.classImgCtn).fadeIn(b.config.speed);
$("."+b.config.classInfo).fadeIn(b.config.speed);b.config.callback()});b.pages={ctn:$("."+b.config.classPages),current:0,items:0,total:0,per:b.config.pagePer};b.renderPages($("."+b.config.classPages))},changeItem:function(a){var b=this,d=$("."+b.config.classLoadingImg);$("."+b.config.classThumbs).find("a").removeClass(b.config.classActiveThumb);a.addClass(b.config.classActiveThumb);a=a.attr("href");b.findItem(a);b.renderTitle($("."+b.config.classTitle));b.renderDescription($("."+b.config.classDescription));
src=b.renderImage($("."+b.config.classImg));b.config.loading&&d.show();$.when(b.utils.preload(src)).then(function(){b.config.loading&&d.hide();$("."+b.config.classImgCtn).css("opacity",0).animate({opacity:1},b.config.speed);b.config.callback()})},changePage:function(a,b){var d,c;"previous"===b?0<this.pages.current&&(d=(this.pages.current-1)*this.pages.per,c=d+this.pages.per,this.pages.current=parseInt(this.pages.current-1),this.renderPages($("."+this.config.classPages))):"next"===b?this.pages.current+
1<this.pages.total&&(d=(this.pages.current+1)*this.pages.per,c=d+this.pages.per,this.pages.current=parseInt(this.pages.current+1),this.renderPages($("."+this.config.classPages))):(d=a.attr("id"),this.pages.current=parseInt(d),d=this.pages.current*this.pages.per,c=d+this.pages.per,this.renderPages($("."+this.config.classPages)));this.sortThumbs(d,c)},render:function(){var a=this,b;b=a.config.html5?$("<section/>"):$("<div/>");b.attr({"class":a.config.classWrapper});a.$elem.append(b);$.when(function(){var d,
c,e=a.data.items,f,g,h;a.config.html5?(d=$("<section/>"),c=$("<nav/>")):(d=$("<div/>"),c=$("<div/>"));d.attr({"class":a.config.classSelectMenu});c.attr({"class":a.config.classSelectNav});g=0;for(h=e.length;g<h;++g)f=$("<a/>",{alt:e[g].id,href:"#",html:e[g].id,title:e[g].id}),c.append(f);d.append(c);b.append(d)}(),function(){var d,c,e=$.Deferred();d=a.config.html5?$("<section/>"):$("<div/>");d.attr({"class":a.config.classGallery});b.append(d);a.config.loading&&(c=a.config.html5?$("<section/>"):$("<div/>"),
c.attr({alt:"Loading...","class":a.config.classLoading,title:"Loading..."}).html('<img src="'+a.config.loading+'" />'),d.append(c));$.when(function(){var b,c,h,e,j=$.Deferred();a.config.html5?(b=$("<article/>"),c=$("<section/>"),h=$("<section/>")):(b=$("<div/>"),c=$("<div/>"),h=$("<div/>"));a.config.loading&&(e=a.config.html5?$("<section/>"):$("<div/>"),e.attr({alt:"Loading...","class":a.config.classLoadingImg,title:"Loading..."}).html('<img src="'+a.config.loading+'" />'),c.append(e));b.attr({"class":a.config.classImg});
c.attr({"class":a.config.classImgCtn});h.attr({"class":a.config.classEnlarge}).html("Click image to enlarge");e=a.renderImage(b);$.when(a.utils.preload(e)).done(function(){j.resolve()});c.append(b,h);d.append(c);return j.promise()}(),function(){var b,c,e,k,j=$.Deferred();a.config.html5?(b=$("<section/>"),c=$("<section/>"),e=$("<section/>"),k=$("<section/>")):(b=$("<div/>"),c=$("<div/>"),e=$("<div/>"),k=$("<div/>"));b.attr({"class":a.config.classInfo});a.renderTitle(c);a.renderCategory(e);a.renderDescription(k);
d.append(b);b.append(c);b.append(e);b.append(k);c=a.config.html5?$("<article/>"):$("<div/>");c.attr({"class":a.config.classThumbs});e=a.renderThumbs(c);$.when(a.utils.preload(e)).done(function(){j.resolve()});b.append(c);a.config.pageShow&&(c=a.config.html5?$("<section/>"):$("<div/>"),c.attr({"class":a.config.classPages}),a.pages={ctn:c,current:0,items:0,pages:0,per:a.config.pagePer},a.renderPages(c),b.append(c));return j.promise()}()).then(function(){e.resolve()},function(){alert("Error: Gallery load failed!")});
return e.promise()}()).then(function(){b.fadeIn(a.config.speed);a.config.callback()},function(){alert("Error: Failed to load gallery!")})},renderTitle:function(a){a.attr({alt:this.selected.item.title,"class":this.config.classTitle,title:this.selected.item.title}).html(this.selected.item.title)},renderCategory:function(a){a.attr({alt:this.selected.cat.id,"class":this.config.classCategory,title:this.selected.cat.id}).html(this.selected.cat.id)},renderDescription:function(a){a.attr({alt:this.selected.item.info,
"class":this.config.classDescription,title:this.selected.item.info}).html(this.selected.item.info)},renderImage:function(a){var b;a.empty();a=$("<a/>",{href:this.config.pathFull?this.config.pathFull+this.selected.item.img:this.config.pathRoot+this.selected.item.img}).appendTo(a);b=this.config.pathRoot+this.selected.item.img;$("<img/>",{src:b}).appendTo(a);return b},renderThumbs:function(a){var b=[],d,c,e,f;a.empty();for(f in this.selected.cat.item)c=$("<a/>").attr({href:this.selected.cat.item[f].img}),
this.selected.item.img===this.selected.cat.item[f].img&&c.addClass(this.config.classActiveThumb),d=this.config.pathThumbs?this.config.pathThumbs+this.selected.cat.item[f].img:this.config.pathRoot+this.selected.cat.item[f].img,e=$("<img/>").attr({src:d}),c.append(e).appendTo(a),b.push(d);return b},renderPages:function(a){a.empty();this.pages.items=this.selected.cat.item.length;this.pages.total=Math.ceil(this.pages.items/this.pages.per);if(this.pages.items>this.pages.per){var b,d,c;this.config.html5?
(a=$("<section/>"),b=$("<section/>")):(a=$("<div/>"),b=$("<div/>"));a.attr({alt:"Previous","class":this.config.classPreviousLink,title:"Previous"}).html("<< Previous");b.attr({alt:"next","class":this.config.classNextLink,title:"next"}).html("Next >>");this.pages.ctn.append(a);for(c=this.pages.total>this.config.pageMax?this.pages.current:0;this.pages.total>c;++c)if(d=this.config.html5?$("<section/>",{alt:"Page "+(c+1),"class":this.config.classPageLink,html:c+1,id:c,title:"Page "+(c+1)}):$("<div/>",
{alt:"Page "+(c+1),"class":this.config.classPageLink,html:c+1,id:c,title:"Page "+(c+1)}),c===this.pages.current&&d.addClass(this.config.classActivePage),this.pages.ctn.append(d),c+1===this.config.pageMax+this.pages.current){c+1<this.pages.total&&(d=this.config.html5?$("<section/>",{html:"...","class":this.config.classMoreLink}):$("<div/>",{html:"...","class":this.config.classMoreLink}),this.pages.ctn.append(d));break}this.pages.ctn.append(b);0===this.pages.current?a.hide():a.show();this.pages.current===
this.pages.total-1?b.hide():b.css("display","inline-block");this.sortThumbs()}},findSelected:function(a){var b,d,c=this.data.items,e,f;e=$("#bg-selected-img").attr("value");var g=$("#bg-selected-cat").attr("value");if(e&&a){a=0;for(f=c.length;a<f;++a)for(var g=c[a],h=void 0,k=void 0,j=void 0,h=0,k=g.item.length;h<k;++h)j=this.utils.formatText(g.item[h].title),e===j&&(d=g.item[h],b=g)}else if(g&&a){a=0;for(f=c.length;a<f;++a)e=this.utils.formatText(c[a].id),e===g&&(b=c[a])}else if(this.config.selectedCat){a=
0;for(f=c.length;a<f;++a)this.utils.formatText(c[a].id)===this.utils.formatText(this.config.selectedCat)&&(b=c[a])}b||(b=c[0]);var l;if(this.config.selectedItem&&!d)for(l in b.item)this.utils.formatText(b.item[l].id)===this.utils.formatText(this.config.selectedItem)&&(b=b.item[l]);d||(d=b.item[0]);return{cat:b,item:d}},findItem:function(a){var b=this.selected.cat,d;for(d in b.item)b.item[d].img===a&&(this.selected.item=b.item[d])},sortThumbs:function(a,b){var d;a||(a=this.pages.current*this.pages.per);
b||(b=a+this.pages.per);d=$(".bg-thumbs a");d.hide();d.slice(a,b).show()},utils:{formatText:function(a){a=a.toLowerCase();a=a.replace(/ /g,"_");a=a.replace(/&/g,"and");return a=a.replace(/[^a-z0-9_]/g,"")},preload:function(a){var b=$.Deferred(),d=[],c,e,f;$.isArray(a)||(a=[a]);e=a.length;for(var g=0;g<e;g++)f=$.Deferred(),c=$("<img />"),c.load(f.resolve),c.error(f.resolve),d.push(f),c.get(0).src=a[g];$.when.apply(this,d).done(b.resolve);return b.promise()}}};
"function"!==typeof Object.create&&(Object.create=function(a){function b(){}b.prototype=a;return new b});$.plugin=function(a,b){$.fn[a]=function(d){return this.each(function(){$.data(this,a)||$.data(this,a,Object.create(b).init(d,this))})}};$.plugin("blurbGallery",blurbGallery);